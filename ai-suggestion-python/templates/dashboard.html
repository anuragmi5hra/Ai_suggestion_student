<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Study Planner ‚Äî Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<!-- ‚úÖ Navigation Bar -->
  <nav class="navbar">
    <a href="{{ url_for('dashboard') }}">Dashboard</a>
    <a href="{{ url_for('suggestions') }}" class="active">Suggestions</a>
    <a href="{{ url_for('progress') }}">Progress</a>
  </nav>

  <div id="nav"></div>

   <div class="book-emoji">üìñ</div>
<div class="pen-emoji">‚úèÔ∏è</div>

  <div class="container" style="max-width:800px;">
    <h2>My Tasks</h2>
    <div class="form-row">
      <input id="taskTitle" placeholder="Task title">
      <input id="taskTopic" placeholder="Topic">
      <input id="taskDeadline" type="date">
    </div>
    <div style="margin-bottom:12px;">
      <button class="btn" id="addTask">Add Task</button>
      <a class="btn" href="suggestions.html" id="viewSuggestions">View Suggestions</a>
      <a class="btn" href="progress.html">View Progress</a>
    </div>

    <div id="taskList"></div>
  </div>

  <!-- <script>
  window.addEventListener('load', () => {
    localStorage.clear();  // Clears token and any saved data
    sessionStorage.clear(); // Clears session storage too (optional)
  });
</script> -->

<script src="{{ url_for('static', filename='js/config.js') }}"></script>
<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
<script>
  // Load tasks from backend
  async function loadTasks() {
    const token = localStorage.getItem('token') || '';
    const res = await fetch(API_BASE + '/tasks', {
      headers: { 'Authorization': 'Bearer ' + token }
    });
    const data = await res.json();

    const list = document.getElementById('taskList');
    list.innerHTML = '';

    (data.tasks || []).forEach(t => {
      const div = document.createElement('div');
      div.className = 'task-item';
      div.innerHTML = `
        <strong>${t.title}</strong> ‚Äî ${t.topic}<br>
        Deadline: ${new Date(t.deadline).toLocaleDateString()}<br>
      `;

      // Create Delete button
      const delBtn = document.createElement('button');
      delBtn.className = 'btn-small';
      delBtn.textContent = 'Delete ‚ùå';
      delBtn.addEventListener('click', async () => {
        try {
          const resDel = await fetch(API_BASE + '/tasks/' + t._id, {
            method: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + token }
          });
          const delData = await resDel.json();
          if (delData.success) {
            loadTasks(); // Refresh list
          } else {
            alert(delData.message || 'Failed to delete task');
          }
        } catch (err) {
          console.error(err);
          alert('Error deleting task');
        }
      });

      div.appendChild(delBtn);
      list.appendChild(div);
    });
  }

  // Add new task
  document.getElementById('addTask').addEventListener('click', async () => {
    const title = document.getElementById('taskTitle').value;
    const topic = document.getElementById('taskTopic').value;
    const deadline = document.getElementById('taskDeadline').value;
    const token = localStorage.getItem('token') || '';

    try {
      const res = await fetch(API_BASE + '/tasks/add', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token
        },
        body: JSON.stringify({ title, topic, deadline })
      });

      const data = await res.json();
      if (data.success) {
        loadTasks(); // Refresh list
      } else {
        alert(data.message || 'Could not add task');
      }
    } catch (err) {
      console.error(err);
      alert('Error adding task');
    }
  });

  // Initial load
  window.addEventListener('load', loadTasks);
</script>


<!-- Footer -->
<footer class="footer">
  <div class="footer-container">
    <p>&copy; 2025 Study Planner App. All Rights Reserved.</p>
    <p>Made with ‚ù§Ô∏è by <strong>Anurag</strong></p>
    <div class="footer-links">
      <a href="https://www.linkedin.com/in/anurag-mishra-20006/" target="_blank" title="LinkedIn" class="social-icon">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/linkedin.svg" alt="LinkedIn">
      </a>
      <a href="https://www.instagram.com/__.anuragmishra/" target="_blank" title="Instagram" class="social-icon">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" alt="Instagram">
      </a>
      <a href="https://x.com/AnuragMish10174" target="_blank" title="Twitter" class="social-icon">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg" alt="Twitter (X)">
      </a>
    </div>
  </div>
</footer>
</body>
</html>